
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel de An√°lise</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <header class="bg-white shadow p-4 flex items-center justify-between">
    <h1 class="text-xl font-bold text-blue-600">üìä Painel de An√°lise</h1>
    <nav class="space-x-4 text-sm text-blue-600">
      <a href="index.html">In√≠cio</a>
      <a href="inscritos.html">Inscritos</a>
      <a href="visualizacoes.html">Visualiza√ß√µes</a>
      <a href="videos.html">V√≠deos</a>
      <a href="video.html">An√°lise de V√≠deos</a>
      <a href="roteiro.html">Roteiriza√ß√£o</a>
      <a href="ao-vivo.html">üî¥ Ao Vivo</a>
      <a href="publicidade.html">üì¶ Publicidade</a>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto p-6">
    <section class="mb-6">
      <p class="text-sm text-gray-700">Canal em an√°lise:</p>
      <p id="canalStatus" class="text-sm font-semibold text-gray-600">Carregando dados...</p>
    </section>

    <section>
      <h2 class="text-lg font-bold text-gray-800 mb-2">‚òëÔ∏è Evolu√ß√£o de Visualiza√ß√µes</h2>
      <canvas id="graficoVisualizacoes" height="200"></canvas>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("youtube_token");
      const url = localStorage.getItem("canal_jairinho_url") || "";
      const canalStatus = document.getElementById("canalStatus");

      if (!token || !url.includes("@")) {
        canalStatus.innerText = "";
        return;
      }

      const nomeUsuario = url.split("@")[1];
      canalStatus.innerHTML = `<strong>@${nomeUsuario}</strong>`;

      try {
        const hoje = new Date().toISOString().split("T")[0];
        const inicio = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split("T")[0];
        const analyticsUrl = `https://youtubeanalytics.googleapis.com/v2/reports?dimensions=day&metrics=views&startDate=${inicio}&endDate=${hoje}&ids=channel==MINE&sort=day`;

        const response = await fetch(analyticsUrl, {
          headers: {
            Authorization: `Bearer ${token}`
          }
        });

        const json = await response.json();
        if (!json.rows) throw new Error("Sem dados");

        const labels = json.rows.map(r => r[0]);
        const dados = json.rows.map(r => r[1]);

        const ctx = document.getElementById("graficoVisualizacoes").getContext("2d");
        new Chart(ctx, {
          type: "line",
          data: {
            labels,
            datasets: [{
              label: "Visualiza√ß√µes (reais)",
              data: dados,
              borderColor: "#2563eb",
              backgroundColor: "rgba(37, 99, 235, 0.1)",
              fill: true,
              tension: 0.4
            }]
          }
        });
      } catch (e) {
        document.getElementById("graficoVisualizacoes").remove();
        const erro = document.createElement("p");
        erro.className = "text-sm text-gray-500 mt-4";
        erro.innerText = "‚ö†Ô∏è Dados n√£o dispon√≠veis. Verifique a conex√£o com o OAuth.";
        canalStatus.after(erro);
      }
    });
  </script>
</body>
</html>
