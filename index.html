<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard InsightYou</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-indigo-900 to-black text-white min-h-screen">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-950 p-6 flex flex-col gap-4 border-r border-gray-800">
      <h1 class="text-2xl font-bold text-white">üìä InsightYou</h1>
      <nav class="flex flex-col gap-3">
        <a href="#" class="text-white/80 hover:text-white font-medium">Dashboard</a>
        <a href="#" class="text-white/80 hover:text-white font-medium">Nova Busca</a>
        <a href="#" class="text-white/80 hover:text-white font-medium">Hist√≥rico</a>
      </nav>
      <div class="mt-auto text-sm text-white/50">Usu√°rio: Analista Social</div>
    </aside>

    <!-- Conte√∫do principal -->
    <main class="flex-1 p-8 overflow-y-auto">
      <div class="mb-8">
        <h2 class="text-3xl font-bold mb-2">Dashboard Anal√≠tico</h2>
        <p class="text-white/60">Monitoramento avan√ßado e dados reais do YouTube</p>
      </div>

      <!-- Cards de resumo -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-gray-800 rounded-xl p-4 shadow">
          <p class="text-sm text-white/60">Perfis Analisados</p>
          <h3 class="text-xl font-bold" id="contagem-perfis">0</h3>
        </div>
        <div class="bg-gray-800 rounded-xl p-4 shadow">
          <p class="text-sm text-white/60">Total de Seguidores</p>
          <h3 class="text-xl font-bold" id="total-seguidores">0</h3>
        </div>
        <div class="bg-gray-800 rounded-xl p-4 shadow">
          <p class="text-sm text-white/60">Total de Views</p>
          <h3 class="text-xl font-bold" id="total-views">0</h3>
        </div>
        <div class="bg-gray-800 rounded-xl p-4 shadow">
          <p class="text-sm text-white/60">Engajamento M√©dio</p>
          <h3 class="text-xl font-bold" id="engajamento">0%</h3>
        </div>
      </div>

      <!-- Buscas Recentes -->
      <div class="bg-gray-800 p-6 rounded-xl shadow mb-8">
        <h4 class="text-lg font-semibold mb-4">√öltimos Canais Pesquisados</h4>
        <ul id="lista-canais" class="space-y-2 text-sm"></ul>
      </div>

      <!-- Resultados ao buscar -->
      <div class="bg-gray-800 p-6 rounded-xl shadow mb-8">
        <h4 class="text-lg font-semibold mb-4">Buscar Canal no YouTube</h4>
        <div class="flex gap-4 mb-4">
          <input type="text" id="canalUrl" placeholder="Cole a URL do canal aqui (ex: https://www.youtube.com/@canal)" class="flex-1 px-4 py-2 rounded-lg border border-gray-600 bg-gray-900 text-white">
          <button onclick="buscarCanal()" class="bg-indigo-600 px-4 py-2 rounded-lg hover:bg-indigo-700">Buscar</button>
        </div>
        <div id="resultado-canal" class="text-sm"></div>
      </div>
    </main>
  </div>

  <script>
    let apiKey = 'AIzaSyBN_mFuMQKR-T6sjH6Ws6n6KSHU5xjwBNU';
    let canais = JSON.parse(localStorage.getItem('canais') || '[]');

    window.onload = atualizarDashboard;

    async function buscarCanal() {
      const url = document.getElementById('canalUrl').value;
      const handle = url.includes('@') ? url.split('@')[1] : url.split('/').pop();
      const endpoint = `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&forHandle=${handle}&key=${apiKey}`;

      try {
        const response = await fetch(endpoint);
        const data = await response.json();
        if (!data.items || data.items.length === 0) {
          alert("Canal n√£o encontrado.");
          return;
        }

        const canal = data.items[0];
        const nome = canal.snippet.title;
        const seguidores = parseInt(canal.statistics.subscriberCount);
        const views = parseInt(canal.statistics.viewCount);

        const indexExistente = canais.findIndex(c => c.nome === nome);
        if (indexExistente >= 0) {
          canais[indexExistente] = { nome, seguidores, views };
        } else {
          canais.push({ nome, seguidores, views });
        }

        localStorage.setItem('canais', JSON.stringify(canais));
        atualizarDashboard();

        document.getElementById('resultado-canal').innerHTML = `
          <p><strong>${nome}</strong><br>
          Seguidores: ${seguidores.toLocaleString()}<br>
          Visualiza√ß√µes: ${views.toLocaleString()}</p>
        `;
      } catch (error) {
        console.error('Erro ao buscar canal:', error);
        alert('Erro ao buscar canal.');
      }
    }

    function atualizarDashboard() {
      const totalPerfis = canais.length;
      const totalSeguidores = canais.reduce((acc, c) => acc + c.seguidores, 0);
      const totalViews = canais.reduce((acc, c) => acc + c.views, 0);
      const engajamento = (totalViews / totalSeguidores * 100).toFixed(1);

      document.getElementById('contagem-perfis').textContent = totalPerfis;
      document.getElementById('total-seguidores').textContent = totalSeguidores.toLocaleString();
      document.getElementById('total-views').textContent = totalViews.toLocaleString();
      document.getElementById('engajamento').textContent = isFinite(engajamento) ? `${engajamento}%` : '0%';

      const lista = document.getElementById('lista-canais');
      lista.innerHTML = canais.map(c => `<li class='flex justify-between'><span>${c.nome}</span><span>${c.seguidores.toLocaleString()} seguidores</span></li>`).join('');
    }
  </script>
</body>
</html>
