
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Aprovar Cadastros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-4xl mx-auto p-6">
    <div class="bg-white rounded-2xl shadow-md p-6 mb-6 text-center">
      <h1 class="text-2xl font-bold text-gray-900">Solicitações de Cadastro</h1>
      <p class="text-sm text-gray-500">Aprovar ou rejeitar novos usuários</p>
    </div>
    <div id="listaSolicitacoes" class="space-y-4"></div>
    <div class="text-center mt-8">
      <a href="index.html" class="text-sm text-blue-600 hover:underline">Voltar ao painel</a>
    </div>
  </div>

  <script>
    if (localStorage.getItem("tipo") !== "admin") {
      window.location.href = "login.html";
    }

    async function carregarSolicitacoes() {
      const res = await fetch("https://opensheet.elk.sh/1d4eiNPGsx96jPUyPfEx45XloSZIDWgpGDXj_dKxO24/Solicitacoes");
      const solicitacoes = await res.json();
      const container = document.getElementById("listaSolicitacoes");

      if (solicitacoes.length === 0) {
        container.innerHTML = '<p class="text-center text-gray-500">Nenhuma solicitação pendente.</p>';
        return;
      }

      solicitacoes.forEach((user, i) => {
  const userCorrigido = {};
  for (let chave in user) {
    userCorrigido[chave.trim()] = user[chave];
  }
  const nome = userCorrigido.Nome;
  const cpf = userCorrigido.CPF;
  const login = userCorrigido.Login;
  const senha = userCorrigido.Senha;
        const card = document.createElement("div");
        card.className = "bg-white shadow rounded-xl p-4 flex justify-between items-center";
        card.innerHTML = `
  <div>
    <p><strong>Nome:</strong> ${nome}</p>
    <p><strong>CPF:</strong> ${cpf}</p>
    <p><strong>Login:</strong> ${login}</p>
  </div>
  <div class="flex gap-2">
    <button class="bg-green-600 text-white px-3 py-1 rounded" onclick="aprovarUsuario('${nome}', '${cpf}', '${login}', '${senha}')">Aprovar</button>
    <button class="bg-red-600 text-white px-3 py-1 rounded" onclick="rejeitarUsuario('${login}')">Rejeitar</button>
  </div>
  
          <div>
            <p><strong>Nome:</strong> ${user.Nome}</p>
            <p><strong>CPF:</strong> ${user.CPF}</p>
            <p><strong>Login:</strong> ${user.Login}</p>
          </div>
          <div class="flex gap-2">
            <button class="bg-green-600 text-white px-3 py-1 rounded" onclick="aprovarUsuario('${user.Nome}', '${user.CPF}', '${user.Login}', '${user.Senha}')">Aprovar</button>
            <button class="bg-red-600 text-white px-3 py-1 rounded" onclick="rejeitarUsuario('${user.Login}')">Rejeitar</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    async function aprovarUsuario(nome, cpf, login, senha) {
      try {
        await fetch("https://hook.us2.make.com/txbnxgo89a2fbajow87kekqdrd7hurm5", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, cpf, login, senha })
        });
        alert("Usuário aprovado com sucesso!");
        location.reload();
      } catch (err) {
        alert("Erro ao aprovar.");
        console.error(err);
      }
    }

    async function rejeitarUsuario(login) {
      try {
        await fetch("https://hook.us2.make.com/SEU_WEBHOOK_REJEITAR", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ login })
        });
        alert("Solicitação rejeitada.");
        location.reload();
      } catch (err) {
        alert("Erro ao rejeitar.");
        console.error(err);
      }
    }

    window.onload = carregarSolicitacoes;
  </script>
</body>
</html>
